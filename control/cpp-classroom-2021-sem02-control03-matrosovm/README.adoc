= Функциональные этюды
:source-highlighter: highlightjs
:revealjs_hash: true
:icons: font
:customcss: https://codepen.io/anstreth/pen/WNvVedL.css
:revealjs_theme: white

C++ часть 2, контрольная работа #3


////
== Как запускать тесты

В файле `smoke.cpp` есть дифайны для каждого из заданий.

Чтобы активировать тесты, вам нужно раскомментировать дифайн.
////

== Задача 1 (1 балл суммарно)

Extensions.

Иногда бывает нужно добавить метод к классу.
В C++ это на данный момент невозможно, но можно попытаться.

Напишите библиотеку, которая позволила бы писать следующее:

[source,cpp]
----
int sum(int a, int b) { ... }

// преобразуем функцию в объект-extension
// первый параметр функции будет в роли this
auto sum_ext = make_ext(sum);

// применяем объект-extension
assert((10 | sum_ext(20) == 30);
----

=== Требования

* Напишите функцию `make_ext`, принимающую произвольный функтор или функцию
и возвращающую extension
* Напишите оператор `|`, который позволяет выполнить extension на объекте
* Для любой функции или функтора `func` верно следующее:
+
[source,cpp]
----
func(obj, args...)
  ==
obj | make_ext(func)(args...)
----

=== Требования, часть 2

* Предполагается, что все функции, с которыми работает `make_ext`, принимают по значению
все свои параметры, кроме первого -- он может быть передан как угодно.
* Соответственно, все параметры должны попасть в вызов функции в корректном виде.

== Задача 2 (2 балла суммарно)

Let's spice things up!

Напишите функцию curry, которая позволяет писать следующее:

[source,cpp]
----
int foo(int a, int b, int c) { ... };

curry(foo)(10)(20)(30);
----

=== Условия задачи

* Напишите функцию curry, работающую для указателей на функции (0.8 балл)
* Напишите функцию curry, работающую для функторов (объектов с оператором `()`) (0.7 балла)
* Реализуйте curry так, чтобы он работал с move-only аргументами (0.5 балла)

=== Требования

* Предполагается, что все функции, с которыми работает `curry`, принимают свои параметры по значению
** Это не значит, что копировать нужно абсолютно всё
* Если у функции/оператора есть перегрузки, curry его не поддерживает (без явного каста)
* curry ничего не знает про параметры по-умолчанию
* Каррирование должно быть полностью type-safe, т.е. такой код не должен скомпилироваться:
+
[source,cpp]
----
int id(int x) { return x; }

curry(id)("hello"s); // неправильный параметр
curry(id)(1)(2)(3); // лишние параметры
----
